
> **Grafana + Loki + Prometheus**

ุงูุฌุง ุชูุฑฺฉุฒ ูุง ุฑู **Grafana Loki** ูุณุช โ ุงุจุฒุงุฑ ฺฉู ุฏููุงู ุจุฑุง ูุงฺฏูฺฏ ุฏุฑ ูุนูุงุฑ cloud-native ุทุฑุงุญ ุดุฏู.

---

## ๐จ Loki ฺูุ (ู ฺุฑุง ุจุง Grafana ุฌูุฑู)

**Grafana Loki** ฺฉ ุณุณุชู ูุงฺฏ ุฌูุนโฺฉู (log aggregation system) ูุณุช ฺฉู:

* ุชูุณุท Grafana ุชูุณุนู ุฏุงุฏู ุดุฏู
* ุจุณุงุฑ ุดุจู ุจู **Prometheus** ฺฉุงุฑ ูโฺฉููุ ูู ุจุฑุง **ูุงฺฏโูุง** ูู ูุชุฑฺฉโูุง
* ุจุฑ ุฎูุงู ELK stack (Elasticsearch/Logstash/Kibana)ุ ููุงุจุน ฺฉูุชุฑ ูุตุฑู ูโฺฉูู

---

## ๐ฆ ูฺฺฏโูุง ุงุตู Loki

| ูฺฺฏ                    | ุชูุถุญ                                                                 |
| ------------------------ | --------------------------------------------------------------------- |
| **lightweight**          | ูุณุจุช ุจู ELK ุจุณุงุฑ ุณุจฺฉโุชุฑู                                             |
| **native integration**   | ุจุง Grafana ุงุฏุบุงู ฺฉุงูููุ ูุงุฒ ุจู ูพูุงฺฏู ูุฏุงุฑ                         |
| **label-based indexing** | ูุงฺฏโูุง ุฑู ูุซู Prometheus ุจุง label ุฐุฎุฑู ูโฺฉููุ ูู full-text indexing |
| **Kubernetes-friendly**  | ุฎู ุฑุงุญุช ูุงฺฏโูุง Podูุงุ namespaceูุง ู containerูุง ุฑู ุฌูุน ูโฺฉูู      |

---

## ๐ง ูุนูุงุฑ ุณุงุฏู Loki ุฏุฑ Kubernetes

```
Pods (App/CI)  
   โ
[ Promtail / Fluent Bit ]  โ ุฌูุนโุขูุฑ ูุงฺฏโูุง
   โ
[       Loki        ]       โ ุฐุฎุฑูโุณุงุฒ ู ุงูุฏฺฉุณ ุจุฑ ุงุณุงุณ Label
   โ
[     Grafana       ]       โ ููุงุด ู ุฌุณุชุฌู
```

---

## ๐ ุจุฑุง ูุงูุชูุฑ CI/CD ู K8s ฺู ฺฉุงุฑ ูโุชููู ุจฺฉููุ

| ูุงุฒ                                         | ฺ ุฑู ูโุจูุ                                                    |
| -------------------------------------------- | ----------------------------------------------------------------- |
| ูุงฺฏ pipelineโูุง (GitLab, ArgoCD, Jenkins...) | ูุงฺฏ ฺฉุงูู ูุฑุงุญู build/deploy/test                                  |
| ูุงฺฏ ูพุงุฏูุง K8s                               | ูุฑ ุฎุทุงุ crashุ ุฎุทุงูุง networkุ ุง custom log                      |
| ูุดุฏุงุฑ (alerting)                             | ูโุชูู ุฑู ูุงฺฏโูุง alert ุจุฐุงุฑ (ูุซูุงู ูุฑ ููุช `error` ุงููุฏ)         |
| ููุชุฑ ุจุง label                               | ูุซูุง ููุท ูุงฺฏโูุง namespace `cicd` ุง ูพุงุฏ `gitlab-runner` ุฑู ุจุจู |

---

## ๐๏ธ ูุตุจ ุฏุฑ Kubernetes (ุฎูุงุตู)

1. ูุตุจ **Loki**:

   ```bash
   helm repo add grafana https://grafana.github.io/helm-charts
   helm upgrade --install loki grafana/loki-stack --namespace logging --create-namespace
   ```

2. ูุตุจ **Promtail** (ุฌูุนโฺฉููุฏู ูุงฺฏโูุง):

   ```bash
   helm upgrade --install promtail grafana/promtail --namespace logging
   ```

3. ูุตุจ **Grafana**:

   ```bash
   helm upgrade --install grafana grafana/grafana --namespace logging
   ```

4. ุงุชุตุงู ุจู Grafana ู ุงุถุงูู ฺฉุฑุฏู Loki ุจู ุนููุงู **Data Source**.

---

## ๐งช ุฌุณุชุฌู ุชู ูุงฺฏโูุง (ูุซุงู)

ุชู Grafanaุ ููุช Loki ุฑู Data Source ฺฉุฑุฏุ ูโุชูู ุจุง queryูุง ูุซู ุฒุฑ ูุงฺฏ ุจฺฏุฑ:

```logql
{namespace="cicd", pod=~"gitlab.*"} |= "error"
```

* ูุงฺฏโูุง ฺฉู ุงุฒ namespace=`cicd` ู ูพุงุฏูุง ฺฉู ุจุง `gitlab` ุดุฑูุน ูโุดู ูุงู
* ููุท ูุงฺฏโูุง ฺฉู ุดุงูู "error" ูุณุชู

---

## ๐ฏ ุฌูุนโุจูุฏ ุณุฑุน

| ุงุจุฒุงุฑ        | ููุด                              |
| ------------ | -------------------------------- |
| **Loki**     | ุฌูุนโุขูุฑ ู ุฐุฎุฑู ูุงฺฏโูุง          |
| **Promtail** | ุฌูุนโฺฉููุฏู ูุงฺฏ ุงุฒ ูพุงุฏูุง           |
| **Grafana**  | ุฌุณุชุฌูุ ุฏุงุดุจูุฑุฏุ ูุดุฏุงุฑ (Alerting) |

---

ุง
